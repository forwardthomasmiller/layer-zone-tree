# 第四章：给架子配上收纳箱

---

上一章的结尾，我们停在了一个有点尴尬的位置。

收纳柜买了。三层架子也分好了——界面、逻辑、数据，各就各位。效果确实有：找东西有了方向，给AI的指令也比以前精准了不少。

但每层架子上的东西还是散着的。

尤其是逻辑层。任务管理、计时器服务、番茄钟逻辑、日程规划、状态管理、通知触发……十几个文件堆在"逻辑层"这个大类里，你知道要找的东西在三楼，但三楼本身就是一片汪洋。

这一章解决这个问题：怎么给架子上的东西分组归类。

---

## Zone：贴好标签的收纳箱

分层解决了"分几层"，但没解决"每层内部谁跟谁是一伙的"。十几个文件堆在逻辑层，你知道要找的东西在三楼，但三楼本身就是一片汪洋。

我需要一个东西来给架子上的文件分组。我叫它 **Zone**。

一句话定义：**Zone 是 Layer 内部按职责聚类的功能分区。**

听起来有点抽象。用收纳箱的类比就直觉了：

Layer 是收纳柜的一层架子。Zone 是放在架子上的收纳箱——贴好标签的那种。

- **标签** = 职责定义。比如"任务管理""计时服务""日程规划"。标签写的是这个箱子装什么，不是装了哪些文件。
- **放入** = 符合这个职责的文件归进来。CardManager.swift 处理任务的增删改查？放进"任务管理"这个箱子。TimerService.swift 负责倒计时？放进"计时服务"那个箱子。
- **放不进** = 如果一个文件跟已有箱子的标签都不匹配，要么它属于另一个已有的箱子（你贴错了），要么你需要新建一个箱子。
- **架子上散落的零碎** = 工具函数、常量、扩展方法这些不属于任何特定业务职责的东西，不用硬塞进箱子里。它们就像架子上的零散物品——放着就行，不需要专门装箱。

回到 GetDone Timer 的逻辑层，那十几个文件一旦装箱：

- `TaskZone`：CardManager、CardGroup、状态流转——所有跟"任务"这个概念相关的逻辑
- `TimerZone`：TimerService、PomodoroService——所有跟"计时"相关的逻辑
- `ScheduleZone`：ScheduleManager、时间规划、冲突检测——所有跟"日程"相关的逻辑
- `AIZone`：AIService、AIAPIClient、PromptAssembly——所有跟"AI助手"相关的逻辑

十几个文件散落在架子上，你看着头大。四个贴好标签的箱子摆在架子上，一目了然。

内容没变。一个文件都没动。变的是你看它们的方式。

---

## Zone 是标签，不是搬家

这一点非常关键，值得单独拿出来说。

**Zone 是逻辑概念，不对应物理文件夹。**

你不需要在 Xcode 里新建一个叫 `TaskZone` 的文件夹，然后把文件拖进去。你不需要改任何目录结构。你不需要移动任何文件。

你只需要知道——"CardManager.swift 属于 TaskZone，TimerService.swift 属于 TimerZone"——就像给每个文件贴了一个隐形标签。

这个区分很重要，因为它决定了 Zone 的引入成本。

如果 Zone 意味着你要重新组织项目的文件夹结构、移动文件、修改 import 路径、处理编译错误——那代价太高了。对于一个正在快速迭代的 Vibe Coding 项目，你不可能停下来花一整天重构目录。

但 Zone 不要求你做这些事。它是纯粹的认知工具。文件还在原来的位置，代码一行不用改，编译器不需要知道 Zone 的存在。Zone 存在于你的头脑里——或者更准确地说，存在于你和 AI 共享的一份文档里。

**引入成本：零。**

你只是给已有的文件贴了标签。就像你不需要把图书馆的书搬到新书架上——你只需要在每本书上贴一个小标签，标明它属于哪个类别。书还在原来的位置，但你知道它是哪一类的了。

对 Vibe Coder 来说，这意味着你可以在任何时候引入 Zone，不需要暂停开发，不需要重构代码，不会打断你的节奏。今天你意识到逻辑层需要归类了，今天就可以开始贴标签。明天继续 Vibe Coding，该加功能加功能。

---

## 贴上标签之后的变化

Zone 看起来只是"给文件分了个组"，一个很轻的动作。但这个轻动作带来的变化，在实际开发中是质变级别的。

用两个具体场景来说明。

**场景一：AI 的工作范围**

假设你要改"暂停逻辑"——计时器运行中，用户点了暂停，状态应该怎么保存、怎么恢复。

没有 Zone 的时候，你怎么跟 AI 说？"帮我改一下逻辑层里暂停相关的代码。" 逻辑层有多少文件？十几个。AI 需要把这十几个文件全部读一遍，理解它们之间的关系，判断哪些跟"暂停"有关、哪些没关——然后才能开始改。

上下文窗口就这么大。十几个文件往里一塞，大半空间被"跟暂停完全没关系"的文件占掉了。TaskZone 里任务排序的逻辑、ScheduleZone 里冲突检测的代码、AIZone 里 prompt 组装的方法——这些东西占着 AI 的注意力，但对"改暂停逻辑"这个任务毫无贡献。

有了 Zone 之后，你说的是："TimerZone 里，暂停时的状态保存逻辑需要改一下。" TimerZone 有几个文件？四个。AI 把这四个文件全部读透，每一行都仔细理解，注意力百分之百集中在计时相关的代码上。

同样的上下文窗口。第一种方式，AI 的注意力被稀释在十几个文件里。第二种方式，AI 的全部注意力聚焦在四个文件上。

**指令的精准度不同，AI 的理解深度就不同，最终的输出质量也不同。**

这不是 AI 变聪明了——是你给它的上下文变干净了。

**场景二：改 A 不小心动了 B**

你让 AI 改任务的排序逻辑。AI 改完了，排序没问题。但第二天你发现日程显示坏了——时间块的顺序全乱了。

怎么回事？因为没有分类的时候，任务排序和日程查询的代码可能挤在同一个文件里（当初随手写的，什么都往一个地方塞）。AI 改排序逻辑的时候，顺手动了同一个文件里日程相关的部分——它不是故意的，它只是觉得这些代码"看起来相关"。

有了 Zone 之后，任务排序的代码在 TaskZone，日程显示的代码在 ScheduleZone。你说"改 TaskZone 里的排序逻辑"，AI 的活动范围被限定在 TaskZone 的那几个文件里，根本不会碰到 ScheduleZone 的东西。

**Zone 划出了边界：这个箱子里的东西你可以动，别的箱子别碰。** 改 A 就只改 A，B 不会被误伤。

---

## 站远一点看

到这里，我们有了两样东西：

**收纳柜**（Layer）——把代码按界面、逻辑、数据分成三层架子。

**收纳箱**（Zone）——在每层架子上，按职责把文件归入贴好标签的箱子。

分类系统完成了。每一个文件都有了明确的归属：它在哪一层、属于哪个箱子。不再是一堆散落的文件，而是有层次、有分组、有标签的有序结构。

但有一个问题还没解决。

你能一眼看清整个房间长什么样吗？

三层架子、每层几个箱子、每个箱子里几个文件、箱子和箱子之间有什么关系、有没有文件放错了箱子、有没有箱子装得太满快要溢出来了——这些信息，你能一张图全看到吗？

现在还不能。你知道每个文件属于哪个 Zone，但你脑子里没有一张完整的"全景图"。就像你整理好了房间里的每一个收纳箱，但你没有站到门口回头看一眼整个房间的全貌。

你需要站远一点，给整个房间拍一张全景照。

---

**本章小结**

> 分层告诉你"分三层"，但每层内部十几个文件谁跟谁是一伙的？Zone 解决这个问题。
>
> Zone 是 Layer 内部按职责聚类的功能分区——就是贴好标签的收纳箱。
>
> Zone 是逻辑概念，不是物理文件夹。你不需要移动任何文件、改任何目录结构。引入成本为零，但效果是质变级别的：给 AI 的上下文从一整层的散乱文件，变成一个箱子里的几个精准文件。
>
> 收纳柜 + 收纳箱 = 分类系统完成。但你还差一张全景照——站远一点，看看整个房间长什么样。
